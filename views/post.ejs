<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    
    <title>CGN | POST#<%= post.id %></title>
    <style>

    </style>
</head>

<style> 
    .img-fluid{
        border-radius: 15px;
    }

    #default{
      color:gray;
    }

    #hidden{
      color:red;
    }

    .text{
        word-break: break-all;
        font-family: 'Montserrat';
    }

    .author{
        font-size: 3vh;
    }

    .date{
      color:gray;
      font-weight: 300;
    }

    @media screen and (max-width: 1980px) {
      .newInput{
      word-break: break-all;
      font-family: 'Montserrat';
      border-width:1px;
      height: 3vw;
      border-radius: 15px;
      width: 20vw;
      }
   }

   .links{
     color:gray;
     font-weight: 400;
     text-decoration: none;
   }

   .btn-dark{
    width:140px;
    height: 50px;
    border-radius: 10px;
   }
    
   #comment{
      height: 50px;
      width: 1000px;
      outline: none;
      border-radius: 15px;
      border-color: black 
   }
   

   @media screen and (max-width: 1480px) {

    #comment{
        height: 45px;
        width: 450px;
        outline: none;
      }

  }
    @media screen and (max-width: 700px) {
      .newInput{
        word-break: break-all;
        font-family: 'Montserrat';
        height: 10vw;
        border-radius: 15px;
        width: 40vw;
      }

      #comment{
        height: 45px;
        width: 300px;
        outline: none;
      }
    }

    .button{
      font-family: 'Montserrat';
      background: black;
    }
    
    .button:hover{
      color:white;
      background-color:black;
      transform: translateY(-6px);
    }

</style>



<body class="bg-dark" >

  <div id="post_id" style="display:none;"><%= post.id %></div>
  <div class="container">
    <header class="bg-dark text-white text">
        <div class="container">
          <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
            <a class="navbar-brand" href="/"><img class="img-fluid" style="border-radius:10px" src="http://cybergamenews.ru/icon.png" width="200" height="100" alt=""></a>
    
            <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
              <li><a href="/" class="nav-link px-2 text-secondary">Главная</a></li>
              <li><a href="/sales" class="nav-link px-2 text-white">Скидки</a></li>
              <li><a href="/posts/" class="nav-link active px-2 text-white">Обзоры</a></li>
            </ul>
            <div class="text-end">
            <%if (req.session.secret_id) { %>
              <div class="dropdown text-end">
                <a href="#" class="d-block link-light text-decoration-none dropdown-toggle" id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
                  <img src=" <%= image %> " alt="mdo" width="32" height="32" class="rounded-circle">
                </a>
                <ul class="dropdown-menu text-small" aria-labelledby="dropdownUser1">
                  <li><a class="dropdown-item " href="/settings">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sliders2" viewBox="0 0 16 16">
                      <path fill-rule="evenodd" d="M10.5 1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4H1.5a.5.5 0 0 1 0-1H10V1.5a.5.5 0 0 1 .5-.5ZM12 3.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm-6.5 2A.5.5 0 0 1 6 6v1.5h8.5a.5.5 0 0 1 0 1H6V10a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5ZM1 8a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2A.5.5 0 0 1 1 8Zm9.5 2a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V13H1.5a.5.5 0 0 1 0-1H10v-1.5a.5.5 0 0 1 .5-.5Zm1.5 2.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Z"/>
                    </svg> Настройки</a></li>
                    <li><a class="dropdown-item" href="/profile/<%=user_id%>">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                        <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
                      </svg> Профиль</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="/leave">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-door-closed" viewBox="0 0 16 16">
                        <path d="M3 2a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v13h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3V2zm1 13h8V2H4v13z"/>
                        <path d="M9 9a1 1 0 1 0 2 0 1 1 0 0 0-2 0z"/>
                      </svg> Выйти</a></li>
                </ul>
              </div>
              <% }else{ %>
                
                <a href="/auth/login" type="submit" class="btn btn-outline-light me-2" >Войти</a>
                <a href="/auth/regist" type="submit" class="btn btn-warning">Зарегистрироватся</a>
                <%}%>
            </div>
          </div>
        </div>
      </header>

    <%if (!editMode) {%>
      <%if (post.photo2) { %>

        <div class="bg-white container text-dark" style="margin-bottom:2.5vw; border-radius: 15px; margin-top:2vw; padding-top: 1vw; padding-left: 1vw;">
            <div class="row">
              <div class="col-9">
                <h1 style="word-break: break-all; margin:0; font-family: 'Montserrat'; font-weight: bold;"><%= post.title %> 
                  <a class="bg-white" type="submit" id="like">
                    <span id="default">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart" viewBox="0 0 16 16">
                    <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"/>
                  </svg>
                </span>
                 
                
                
                <span id="hidden" style="display:none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16">
                      <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/>
                    </svg></a></span>
                  <span id="counter" class="font-size:0.5vw;"><%= post.likes %></span>
        </h1>

              <style>
                #like{
                  border: none;
                  text-decoration: none;
                }
              </style>
              </div>
              <div class="col-3">
                    <h1 style="position: relative; text-align: right; font-family: 'Montserrat'; font-weight:400; font-size:2.15vw; color:gray;">-<a class="author" style="color:gray;" href="/profile/<%= user.user_id %>"><%= user.username %></a> 
                    <span class="date" style="font-size:2vw;">(<%= date %>)</span>  
                    </h1> 
              </div>   
            </div>
                    <h4 class="text sdesc"><%= post.short_desc %></h4>              
                    <hr style="height: 2.5px; color:#212529;">    
                    <img class="img-fluid" src=<%= post.photo_url %> style='width:80%'>
                    <hr style="height: 2.5px; color:#212529;">              
                    <h4 id="post_desc" class="text"><%= post.text %></h4>
                    <hr style="height: 2.5px; color:#212529;"> 
                    <img class="img-fluid" src=<%= post.photo2 %> style='width:80%; padding-bottom:1vw;'>    
                    <hr style="height: 2.5px; margin:0; margin-bottom:1vw; color:#212529;"> 

                    <%if (req.session.secret_id) { %>
                    <p><a class="links" href="/posts/edit/<%= post.id %>">Изменить</a></p>
                    <p style="padding-bottom:2vw;"><a class="links" href="/posts/delete/<%= post.id %>">Удалить</a></p>
                    <%}%>

                  </div>
                  
                    <div class="comments">
                      <h1 class="text-center text-mont text-white" style="font-family: 'Montserrat';">Комментарии</h1>
              
                      
                        <div class="bg-secondary container text-dark text" style="margin-bottom:2.5vw; border-radius: 15px; margin-top:2vw; padding-top: 1vw; padding-left: 1vw; padding-bottom:1vw; ">
                          <%if(req.session.secret_id) {%>
                          <form id="comForm" action="/comment/<%= post.id%>" method="post" style="margin-bottom: 1vw;">
                              <img src="http://cybergamenews.ru/<%= image %>" alt="mdo" width="32" height="32" class="rounded-circle">
                            <input name="comment" id="comment" class="text-white bg-dark" type="text" required="" placeholder="Ваш комментарий...">
                            <button type="submit" class="text btn btn-dark text-white"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-send" viewBox="0 0 16 16">
                              <path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"/>
                            </svg> Отправить</button>
                          </form>
                        <%}%>  
              
                        <div id="comments">
                          <%for(var i = 0; i < post.comments.length; i++){ %>
                            <div class="user_clr" style="display: none;"><%= post.comments[i].user.color %></div>
              
                            <p class="text text-white"><a style="text-decoration:none;" href='/profile/<%= post.comments[i].user.user_id %>' ><span class="username" style="font-weight: 900;"><%= post.comments[i].user.username %></span></a> <small>(<%= dates[i] %>)</small>:  <%= post.comments[i].content %></p>
                          <%}%> 
                        </div>
                          
                      </div>
                         
                    </div>

      <% }else{ %>
        <div class="bg-white container text-dark" style="margin-bottom:2.5vw; border-radius: 15px; margin-top:2vw; padding-top: 1vw; padding-left: 1vw;">
          <div class="row">
            <div class="col-9">
              <h1 style="word-break: break-all; margin:0; font-family: 'Montserrat'; font-weight: bold;"><%= post.title %> 
                <a class="bg-white" type="submit" id="like">
                  <span id="default">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart" viewBox="0 0 16 16">
                  <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"/>
                </svg>
              </span>
               
              
              
              <span id="hidden" style="display:none;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/>
                  </svg></a></span>
                <span id="counter" class="font-size:0.5vw;"><%= post.likes %></span>
      </h1>

            <style>
              #like{
                border: none;
                text-decoration: none;
              }
            </style>
            </div>
            <div class="col-3">
                  <h1 style="position: relative; text-align: right; font-family: 'Montserrat'; font-weight:400; font-size:2.15vw; color:gray;">-<a class="author" style="color:gray;" href="/profile/<%= user.user_id %>"><%= user.username %></a> 
                  <span class="date" style="font-size:2vw;">(<%= date %>)</span>  
                  </h1> 
            </div>   
          </div>   
          <h4 class="text sdesc"><%= post.short_desc %></h4>                 
          <hr style="height: 2.5px; color:#212529;">    
          <img class="img-fluid" src=<%= post.photo_url %> style='width:80%'>
          <hr style="height: 2.5px; color:#212529;">              
          <h4 class="text" id="post_desc"><%= post.text %></h4>
          <hr style="height: 2.5px; margin:0; margin-bottom:1vw; color:#212529;"> 

          <%if (req.session.secret_id) { %>
          <p><a class="links" href="/posts/edit/<%= post.id %>">Изменить</a></p>
          <p style="padding-bottom:2vw;"><a class="links" href="/posts/delete/<%= post.id %>">Удалить</a></p>
          <%}%>  
      </div>

      <div class="comments">
        <h1 class="text-center text-mont text-white" style="font-family: 'Montserrat';">Комментарии</h1>

        
          <div class="bg-secondary container text-dark text" style="margin-bottom:2.5vw; border-radius: 15px; margin-top:2vw; padding-top: 1vw; padding-left: 1vw; padding-bottom:1vw; ">
            <%if(req.session.secret_id) {%>
            <form id="comForm" action="/comment/<%= post.id%>" method="post" style="margin-bottom: 1vw;">
                <img src="http://cybergamenews.ru/<%= image %>" alt="mdo" width="32" height="32" class="rounded-circle">
              <input name="comment" id="comment" class="text-white bg-dark" type="text" required="" placeholder="Ваш комментарий...">
              <button type="submit" class="text btn btn-dark text-white"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-send" viewBox="0 0 16 16">
                <path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"/>
              </svg> Отправить</button>
            </form>
          <%}%>  

          <div id="comments">
            <%for(var i = 0; i < post.comments.length; i++){ %>
              <div class="user_clr" style="display: none;"><%= post.comments[i].user.color %></div>
              <p class="text text-white"><a style="text-decoration:none;" href='/profile/<%= post.comments[i].user.user_id %>' ><span class="username" style="font-weight: 900;"><%= post.comments[i].user.username %></span></a> <small>(<%= dates[i] %>)</small>:  <%= post.comments[i].content %>
              <%if(adminMode || post.comments[i].user.secret_id == req.session.secret_id) { %>
                <a style="text-decoration:none;" id="trash" href="/delete/<%= post.id %>_<%= post.comments[i].content %>"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
                  <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/>
                </svg></a>

                <style>
                  #trash{
                    position: absolute;
                    color:whitesmoke;
                    padding-left:0.3vw;
                  }

                  #trash:hover{
                    color:rgba(255, 0, 0, 0.815)
                  }
                </style>
              <%}%>
              </p>
            <%}%> 
          </div>
            
        </div>

      </div>
      <%}%> 
  <% }else{ %>
    <form method="post" action="/posts/edits/<%= post.id%>">
      <%if (post.photo2) { %>
        <div class="bg-white container text-dark" style="margin-bottom:2.5vw; border-radius: 15px; margin-top:2vw; padding-top: 1vw; padding-left: 1vw;">
                    <h1 class="toInput title" style=" font-family: 'Montserrat'; font-weight: bold;"><%= post.title %></h1>
                    <h1 style="position: relative; text-align: right; font-family: 'Montserrat'; font-weight:400; font-size:2.15vw; color:gray;">-<a class="author" style="color:gray;" href="/profile/<%= user.user_id %>"><%= user.username %></a> 
                    <span class="date" style="font-size:2vw;">(<%= date %>)</span>  
                    </h1>  
                    <h4 class="text toInput sdesc"><%= post.short_desc %></h4>                
                    <hr style="height: 2.5px; color:#212529;">    
                    <img class="img-fluid" src=<%= post.photo_url %> style='width:80%'>
                    <hr style="height: 2.5px; color:#212529;">              
                    <h4 class="text toInput title desc" id="post_desc"><%= post.text %></h4>
                    <hr style="height: 2.5px; color:#212529;"> 
                    <img class="img-fluid" src=<%= post.photo2 %> style='width:80%; padding-bottom:1vw;'>    
        </div>

      <% }else{ %>
        <div class="bg-white container text-dark" style="margin-bottom:2.5vw; border-radius: 15px; margin-top:2vw; padding-top: 1vw; padding-left: 1vw;">
          <h1 class='toInput title' style=" font-family: 'Montserrat'; font-weight: bold;"><%= post.title %></h1>
          <h1 style="position: relative; text-align: right; font-family: 'Montserrat'; font-weight:400; font-size:2.15vw; color:gray;">-<a class="author" style="color:gray;" href="/profile/<%= user.user_id %>"><%= user.username %></a> 
          <span class="date" style="font-size:2vw;">(<%= date %>)</span>  
          </h1>    
          <h4 class="text toInput sdesc"><%= post.short_desc %></h4>                  
          <hr style="height: 2.5px; color:#212529;">    
          <img class="img-fluid" src=<%= post.photo_url %> style='width:80%'>
          <hr style="height: 2.5px; color:#212529;">              
          <h4 class="text toInput desc" id="post_desc"><%= post.text %></h4>
          <hr style="height: 2.5px; color:#212529;"> 
        </div>
      <%}%>
      <button type="submit" class="btn bg-white button" style="display: none; border-radius: 15px;">Сохранить</button>
    </form>
  <%}%> 

  <% if(!editMode) { %><div id="alreadyLiked" style="display:none;"><%= alreadyLiked %></div> <%}%>

  </div>
  </div>
 
  <script>
 

    let post_id = document.getElementById('post_id').textContent;

    let post_desc = document.getElementById('post_desc').textContent
    let newdesc = post_desc.replace(/\\n/g, '<br>');

    document.getElementById('post_desc').innerHTML = newdesc;

    let counter = document.getElementById('counter')
    let user_clr = document.getElementsByClassName('user_clr').textContent;

    let allusers = document.getElementsByClassName('username').length
    for(let i = 0; i<allusers; i++){
      let name = document.getElementsByClassName('username').item(i).style.color = 'rgb('+document.getElementsByClassName('user_clr').item(i).textContent + ')';
    }
    console.log(allusers)

    var i = 'inputA';
    $('.toInput').click(function(){
      
      $('.button').css('display', 'flex')

      if($(this).hasClass('desc')){
        $(this).replaceWith("<input name='desc' class='newInput desc' value='" + $(this).text() + "'>");
      } 

      if($(this).hasClass('title')){
        $(this).replaceWith("<input name='title' class='newInput title' value='" + $(this).text() + "'>");
      }
      
      if($(this).hasClass('sdesc')){
        $(this).replaceWith("<input name='sdesc' class='newInput sdesc' value='" + $(this).text() + "'>");
      }
    });

    $('#like').click(
      function(){
        $.ajax({
          	url: `/like/${post_id}`,
          	method: 'get',      
	          dataType: 'json',        
            success: (response) => { 
             if(response.Success == 'готово!'){
              document.getElementById('default').style.display='none';
              document.getElementById('hidden').style.display='block';
              counter.textContent = Number(counter.textContent) + 1;
             }else{
              document.getElementById('hidden').style.display='none';
              document.getElementById('default').style.display='block';
              counter.textContent = Number(counter.textContent) - 1;              
             }
          }          
	      })
      }
    )


    let likedOrNot = document.getElementById('alreadyLiked').textContent;

    if(likedOrNot == 'true'){
      document.getElementById('hidden').style.display = 'block';
      document.getElementById('default').style.display = 'none';
    }


  </script>

</body>
</html>
